# ロボットプロセス生成プロンプト - ステージ 1：ユーザー入力から詳細プロセス記述へ

## 目的

このプロンプトは、ユーザーが提供するロボットタスク記述（通常は自然言語の Markdown 形式）に基づいて、詳細なプロセス計画を生成することを目的としています。この計画には、メインプロセスと複数のサブプロセスの明確な記述、およびそれぞれのプロセスステップとコアロジックのテキスト説明が含まれている必要があります。目標は、ロボットタスク実行のための構造化された理解しやすい青写真を作成し、ユーザーレビューと後続の改良ステップの基礎として機能することです。

## 入力

1.  **ロボットタスク記述（.md またはテキスト）**：ロボットが完了することが期待される全体的なタスク、サブタスク、および操作対象に関する自然言語の記述が含まれています。

## 生成ガイドラインと要件

提供されたタスク記述に基づいて詳細なプロセス記述を生成するには、以下のガイドラインに従ってください。

### 1. サブプログラム/機能の設計と定義（論理レベル）

- **コア機能モジュールの特定**：タスク記述から主要な操作と論理ユニットを抽出し、サブプログラムの候補を考案します。
- **サブプログラム名と略語の設計**：サブプログラム名内の略語（例：`BRG`、`PLT`、`CNV`、`RMC`、`LMC`、`BH`、`Crump`）に特に注意を払い、簡潔で機能を反映していることを確認します。サブプログラム名は、その目的を明確に表現する必要があります。
- **サブプログラム機能の明確化**：各サブプログラムが実行すべき特定のタスク、操作対象、および期待される結果を詳細に記述します。例：取得、配置、ベアリング、パレット、コンベア、加工ユニット、クランプ操作など。
- **アクションタイプの明確化**：サブプログラムの記述において、`Get`（取得/ピック）や`Put`（配置/置く）などの一般的なアクションを明確に区別します。
- **ペア操作の設計**：`Open_..._Clamp`と`Close_..._Clamp`など、論理的にペアとなるサブプログラムの設計に注意を払い、その機能を明確にします。

### 2. サブプログラムのモジュール化と再利用戦略計画（論理レベル）

- **標準操作シーケンスの再利用計画**：複数のサブプログラムで再利用できる標準操作シーケンスのロジックを特定し、記述します。例：
  - 材料把持/配置プロセス：「ターゲットに接近 -> 正確な位置決め -> アクション実行（例：把持/解放）-> ターゲットから離脱 -> 安全な位置に戻る」という一般的なロジックを記述します。
  - クランプ操作のカプセル化：クランプ制御ロジックがどのようにカプセル化され、さまざまな材料処理操作で呼び出されるかを記述します。
- **モジュラーデザイン**：クランプ制御、モーション制御などを、独立した再利用可能な論理モジュールとして記述すべきかどうかを計画します。
- **パラメータ化と構成に関する考慮事項**：柔軟性を高めるために、サブプログラムの動作を調整するために変数またはパラメータ（速度、力など）が必要かどうかを記述に含めます。
- **ネストされた呼び出し関係**：タスクを合理的に分解および結合するために、サブプログラム間の論理的な呼び出し関係を計画し、記述します。
- **対称/対応操作**：機能的に補完的または対応するサブプログラムペアのロジックを設計します。

### 3. メインプログラムコアロジックの構築（論理レベル）

- **メインプログラム初期化ステップの計画**：メインプログラムの開始時に通常実行される初期化ロジック（例：ロボットモデルの選択、モーターの起動、主要変数の初期化など）を記述します。
- **メインプログラム制御フローの設計**：メインループ、条件判断などの存在など、メインプログラムのマクロ制御フローを記述します。
- **メインプログラムのサブプログラム呼び出しシーケンスの編成**：メインプログラムがサブプログラムを順次呼び出すことによって全体的なタスクをどのように完了するかを計画し、記述し、各サブプログラム呼び出しのタイミングと目的を明確に説明します。
- **状態遷移と同期ロジックの考慮**：プログラムが特定の条件（例：センサー信号、外部 IO）を待機したり、信号を送信したりすることによって、外部環境または他のデバイスとどのように同期および対話するかのロジックを記述します。
- **安全性と移行ロジックの考慮**：ロボットがさまざまなタスクステージ間で特定の安全ポイントまたは移行ポイントに移動する必要があるかどうかに注意してください。
- **エラー処理とオプションパスロジックの考慮**：代替パスまたはエラー処理メカニズムが必要かどうかを検討し、記述します。一時的に有効になっていないが将来必要になる可能性のある機能については、そのロジックを記述し、オプションとしてマークすることができます。
- **終了と復帰ロジックの定義**：メインプログラムと各サブプログラムを終了する方法と条件を明確に定義します。

要約すると、ユーザーの自然言語タスク記述を、メインプロセスと各サブプロセスの責任、コアステップロジック、およびそれらの間の連携関係を明確に定義する、詳細で構造化されたドキュメントに変換する必要があります。この記述は、ユーザーの確認と変更のための視覚的な計画として機能します。

## Fewshot の例

### タスク入力の例（元のユーザー記述）

[ロボットタスク記述：この自動化プロセスは、ベアリング（BRG）、ベアリングハウジング（BH）、およびパレット（PLT）が関与する組み立ておよび取り扱いタスクを共同で完了することを目的としています。ロボットはまず、材料ラックまたは初期位置からベアリングとベアリングハウジングを取得します。その後、これら 2 つの部品を右側のマシニングセンター（RMC）に順次配置し、ここで圧入または組み立て操作を行うと推定されます。組み立て後、ロボットは RMC から組み立てられた部品を取り出し、左側のマシニングセンター（LMC）に転送して一時保管または後続処理を行います。次に、ロボットは空のパレットを取得し、このパレットをコンベア（CNV）の指定されたステーションに配置します。最後に、ロボットは LMC から以前に保管されていた組み立て済み部品を取得し、コンベア上のパレットに正確に配置して、サイクル全体を完了します。]

### 出力の例（詳細プロセス記述計画）

#### I. サブプログラムとその機能記述

1.  **`BRG_Get_BRG`（ベアリング取得）**：

    - 機能：ロボットは指定された場所（例：材料ラック）からベアリングを取得します。
    - コアロジック：ベアリング待機ポイントに移動 -> ベアリング上部に移動 -> ベアリングクランプを開く -> ベアリング精密把持ポイントに下降 -> ベアリングクランプを閉じる -> 上昇 -> 出発ポイントに移動 -> 安全/初期ポイントに戻る。
    - 関与するクランプ：`BRG&PLT_Crump`（ベアリングとパレットを操作するためのクランプ）。

2.  **`CNV_Get_BH`（コンベアからベアリングハウジング取得）**：

    - 機能：ロボットはコンベアの指定された場所からベアリングハウジングを取得します。
    - コアロジック：コンベア付近のベアリングハウジング待機ポイントに移動 -> ベアリングハウジング上部に移動 -> ベアリングハウジングクランプを開く -> ベアリングハウジング精密把持ポイントに下降 -> ベアリングハウジングクランプを閉じる -> 上昇 -> 安全/初期ポイントに戻る。
    - 関与するクランプ：`BH_Crump`（ベアリングハウジングを操作するためのクランプ）。

3.  **`RMC_Put_BH&BRG`（ベアリングハウジングとベアリングを右マシニングセンターに配置）**：

    - 機能：ロボットは以前に取得したベアリングハウジングとベアリングを右マシニングセンター（RMC）の指定されたステーションに順次配置します。
    - コアロジック：
      - RMC 待機ポイントに移動。
      - ベアリングハウジング配置：RMC ベアリングハウジング配置ポイントの上部に移動 -> 配置ポイントに正確に移動 -> ベアリングハウジングクランプを開く -> 上昇。
      - ベアリング配置：RMC ベアリング配置ポイントの上部に移動 -> 配置ポイントに正確に移動 -> ベアリングクランプを開く -> 上昇。
      - RMC 出発ポイントに移動。
    - 関与するクランプ：`BH_Crump`、`BRG&PLT_Crump`。
    - 注意：精度を確保するために、配置中に速度を下げる必要がある場合があります。

4.  **`RMC_Get_BH`（右マシニングセンターから組み立て済み部品取得）**：

    - 機能：ロボットは右マシニングセンター（RMC）から組み立て済み（または処理済み）のベアリングハウジングを取得します（この時点で、ベアリングと組み立て済みである可能性があります）。
    - コアロジック：RMC 待機ポイントに移動 -> 組み立て済み部品の上部に移動 -> ベアリングハウジングクランプを開く（以前に開いていた場合は、このステップは把持の準備です） -> 精密把持ポイントに下降 -> ベアリングハウジングクランプを閉じる -> 上昇 -> 出発ポイントに移動。
    - 関与するクランプ：`BH_Crump`。

5.  **`LMC_Put_BH`（部品を左マシニングセンターに配置）**：

    - 機能：ロボットは RMC から取得した部品を左マシニングセンター（LMC）に配置して、一時保管または後続処理を行います。
    - コアロジック：LMC 待機ポイントに移動 -> LMC 配置ポイントの上部に移動 -> 配置ポイントに正確に移動 -> ベアリングハウジングクランプを開く -> 上昇 -> 安全/初期ポイントに戻る。
    - 関与するクランプ：`BH_Crump`。

6.  **`CNV_Get_PLT`（コンベアからパレット取得）**：

    - 機能：ロボットは指定された場所（おそらくコンベアの別の領域）から空のパレットを取得します。
    - コアロジック：パレット待機ポイントに移動 -> パレット上部に移動 -> （おそらく低速で）把持ポイントに正確に移動 -> パレットクランプを閉じる -> 上昇 -> 安全/初期ポイントに戻る。
    - 関与するクランプ：`BRG&PLT_Crump`。

7.  **`CNV_Put_PLT`（パレットをコンベアに配置）**：

    - 機能：ロボットは取得した空のパレットをコンベアの指定されたステーションに配置します。
    - コアロジック：コンベアパレット配置ポイントの上部に移動 -> 配置ポイントに正確に移動 -> パレットクランプを開く -> 上昇 -> 安全/初期ポイントに戻る。
    - 関与するクランプ：`BRG&PLT_Crump`。

8.  **`LMC_Get_BH`（左マシニングセンターから部品取得）**：

    - 機能：ロボットは左マシニングセンター（LMC）から以前に保管されていた部品を取得します。
    - コアロジック：LMC 待機ポイントに移動 -> 部品上部に移動 -> 把持ポイントに正確に移動 -> ベアリングハウジングクランプを閉じる -> 上昇 -> 安全/初期ポイントに戻る。
    - 関与するクランプ：`BH_Crump`。

9.  **`CNV_Put_BH`（部品をコンベアのパレットに配置）**：

    - 機能：ロボットは LMC から取得した部品を、コンベア上の事前に配置されたパレットに正確に配置します。
    - コアロジック：コンベアパレット（積載部品あり）の上部に移動 -> パレット内の指定された配置ポイントに正確に移動 -> ベアリングハウジングクランプを開く -> 上昇 -> 安全/初期ポイントに戻る。
    - 関与するクランプ：`BH_Crump`。

10. **`Open_BH_Crump`（ベアリングハウジングクランプを開く）**：

    - 機能：ロボットのエンドエフェクタを制御して、ベアリングハウジングを保持するために使用されるクランプを開きます。
    - コアロジック：開信号を送信し、クランプが所定の位置にあることのフィードバックを待ちます。

11. **`Close_BH_Crump`（ベアリングハウジングクランプを閉じる）**：

    - 機能：ロボットのエンドエフェクタを制御して、ベアリングハウジングを保持するために使用されるクランプを閉じます。
    - コアロジック：閉信号を送信し、クランプが所定の位置にあることのフィードバックを待ちます。

12. **`Open_BRG&PLT_Crump`（ベアリング/パレットクランプを開く）**：

    - 機能：ロボットのエンドエフェクタを制御して、ベアリングまたはパレットを保持するために使用されるクランプを開きます。
    - コアロジック：開信号を送信し、クランプが所定の位置にあることのフィードバックを待ちます。

13. **`Close_BRG&PLT_Crump`（ベアリング/パレットクランプを閉じる）**：
    - 機能：ロボットのエンドエフェクタを制御して、ベアリングまたはパレットを保持するために使用されるクランプを閉じます。
    - コアロジック：閉信号を送信し、クランプが所定の位置にあることのフィードバックを待ちます。

#### II. メインプログラムプロセス記述

ロボットモデルを選択します（例：「dobot*mg400」）。
ロボットモーターを起動します。
必要なプロセス制御変数を初期化します（例：`N5 = 2`、例の条件判断に使用）。
メインループが開始します。
ループ条件：特定の条件または無限ループに基づく場合があります（この例では、`N5 == 2`に基づいてコアプロセスを 1 回実行します）。
ロボットは**初期/安全ポイント（例：「P1」）**に移動します。
*（オプション/無効ロジック）_外部開始信号を待ちます（例：外部 IO 入力）。
サブプログラム`BRG_Get_BRG`（ベアリング取得）を呼び出します。
_（オプション/無効ロジック）_材料が所定の位置にあるか、ステーションがクリアになる信号を待ちます。
サブプログラム`CNV_Get_BH`（コンベアからベアリングハウジング取得）を呼び出します。
ロボットは**初期/安全ポイント（例：「P1」）**に移動します。
マシニングセンター（RMC）の準備ができている信号を待ちます。
サブプログラム`RMC_Put_BH&BRG`（ベアリングハウジングとベアリングを RMC に配置）を呼び出します。
RMC 加工完了信号を待ちます。
部品が取り出されたか、取り出す準備ができたことを RMC に通知する信号を送信します。
RMC 確認信号を待ちます。
サブプログラム`RMC_Get_BH`（RMC から組み立て済み部品取得）を呼び出します。
ロボットは**初期/安全ポイント（例：「P1」）**に移動します。
サブプログラム`LMC_Put_BH`（部品を LMC に配置）を呼び出します。
ロボットは**初期/安全ポイント（例：「P1」）**に移動します。
サブプログラム`CNV_Get_PLT`（コンベアからパレット取得）を呼び出します。
サブプログラム`CNV_Put_PLT`（パレットをコンベアに配置）を呼び出します。
ロボットは**初期/安全ポイント（例：「P1」）**に移動します。
サブプログラム`LMC_Get_BH`（LMC から部品取得）を呼び出します。
ロボットは**初期/安全ポイント（例：「P1」）**に移動します。
サブプログラム`CNV_Put_BH`（部品をコンベアのパレットに配置）を呼び出します。
_（オプション/無効ロジック）\*タスク完了信号を外部システムに送信します。
メインループが終了します。

#### III. モジュール化と再利用の説明

- **クランプ操作**：`Open/Close_BH_Crump`および`Open/Close_BRG&PLT_Crump`は、さまざまな材料ピックアンドプレースサブプログラムで呼び出される標準のクランプ制御サブプログラムです。
- **移動シーケンス**：ほとんどのピック/プレースサブプログラムは、「待機ポイント -> 接近ポイント -> 精密ポイント -> （アクション実行）-> リフトポイント -> 出発ポイント -> 安全ポイント」の移動ロジックに従います。
- **速度制御**：`RMC_Put_BH&BRG`、`CNV_Get_PLT`などの精密操作では、記述に低速移動フェーズの計画について言及する必要があります。
- **外部インタラクション**：メインプロセスは、プロセス同期のために外部デバイス（RMC、LMC、コンベアセンサー）との複数の信号インタラクションポイントを計画します。デバッグ中に不確実または無効にできるインタラクションは、オプション/無効としてマークされます。
