# 机器人流程生成 Prompt - 阶段一：用户输入到详细流程描述

## 目标

本 Prompt 旨在指导您根据用户提供的机器人任务描述（通常为自然语言 Markdown 格式），生成一份详细的流程方案。该方案应包含一个主流程和多个子流程的清晰描述，以及它们各自的流程步骤和核心逻辑的文字说明。目标是产出一份结构化的、易于理解的机器人任务执行蓝图，作为用户审查和后续细化步骤的基础。

## 输入材料

1.  **机器人任务描述 (.md 或文本)**：包含对机器人期望完成的整体任务、子任务以及操作对象的自然语言描述。

## 生成指引与要求

### 0. 机器人控制块合规性 (关键要求)

**强制块映射**：您过程描述中的每一步都必须严格对应可用的机器人控制块。可用的块及其功能将提供给您。

- **块类型映射**：对于您描述的每个步骤，您必须能够将其映射到一个或多个特定的机器人控制块（例如，`moveP`、`set_motor`、`wait_input`、`procedures_callnoreturn` 等）。
- **能力限制**：请勿描述任何无法通过提供的机器人控制块实现的功能。
- **预防措施合规性**：请严格注意每种块类型提及的预防措施和限制。
- **依赖性要求**：确保正确的顺序和依赖关系（例如，"选择机器人"必须在移动命令之前，"设置电机"必须在移动操作之前）。
- **块类型参考**：在描述每个步骤时，明确提及将用于实现它的块类型。

**带块参考的示例步骤**：

- 描述："机器人移动到初始/安全点 (例如 'P_Home')"
- 块类型：`moveP` 或 `moveL`
- 注意事项：必须首先使用"选择机器人"定义机器人，并在使用前使用"设置电机"打开伺服电源。

### 1. 子程序/函数设计与定义 (逻辑层面)

- **识别核心功能模块**：从任务描述中提取关键操作和逻辑单元，构思子程序的候选。
- **设计子程序名称与缩写**：特别关注子程序名称中的缩写（例如 `BRG`, `PLT`, `CNV`, `RMC`, `LMC`, `BH`, `Crump`），确保其简洁且能反映功能。子程序名称应清晰表达其目的。
- **明确子程序功能**：详细描述每个子程序应执行的具体任务、操作对象以及预期的结果。例如：获取、放置、轴承、托盘、传送带、加工单元、夹具操作等。
- **明确动作类型**：在子程序描述中清晰区分 `Get` (获取/拾取) 和 `Put` (放置/放下) 等常见动作。
- **设计成对操作**：注意设计逻辑上成对出现的子程序，如 `Open_..._Clamp` 和 `Close_..._Clamp`，并阐明其功能。

### 2. 子程序模块化与复用策略规划 (逻辑层面)

- **规划标准操作序列的复用**：识别并描述可在多个子程序中复用的标准操作序列的逻辑。例如：
  - 物料抓取/放置流程：描述"接近目标 -> 精确定位 -> 执行动作（如夹取/释放）-> 离开目标 -> 返回安全位置"的通用逻辑。
  - 夹具操作的封装：描述夹具控制逻辑如何被封装并在不同物料操作中调用。
- **模块化设计**：规划夹具控制、运动控制等是否应被描述为独立的、可复用的逻辑模块。
- **参数化与配置考虑**：在描述中提及是否需要通过变量或参数（如速度、力度）来调整子程序行为，以增加灵活性。
- **嵌套调用关系**：规划并描述子程序之间的逻辑调用关系，以合理分解和组合任务。
- **对称/对应操作**：设计功能上相互补充或对应的子程序对的逻辑。

### 3. 主程序核心逻辑构建 (逻辑层面)

- **规划主程序的初始化步骤**：描述主程序开始时通常执行的初始化逻辑（例如：选择机器人型号、启动电机、初始化关键变量等）。
- **设计主程序的控制流**：描述主程序的宏观控制流程，如是否存在主循环、条件判断等。
- **编排主程序调用子程序的顺序**：规划并描述主程序是如何通过顺序调用子程序来完成整体任务的，清晰说明各子程序调用的时机和目的。
- **考虑状态转换与同步逻辑**：描述程序如何通过等待特定条件（如传感器信号、外部 IO）或发出信号与外部环境或其他设备进行同步和交互的逻辑。
- **考虑安全与过渡逻辑**：注意描述机器人在不同任务阶段之间是否需要移动到特定的安全点或过渡点。
- **考虑错误处理与可选路径逻辑**：思考并描述是否需要备用路径或错误处理机制。对于暂时不启用但未来可能需要的功能，可以描述其逻辑并标记为可选。
- **定义结束与返回逻辑**：明确主程序及各子程序结束的方式和条件。

总结来说，您需要将用户的自然语言任务描述，转化为一份详细的、结构化的文案，清晰定义主流程和各子程序的职责、核心步骤逻辑、以及它们之间的协作关系。这份描述将作为可视化方案，供用户确认和修改。

## 示例 fewshot

### 示例任务输入 (原始用户描述)

[机器人任务描述：该自动化流程旨在协同完成一个涉及轴承（BRG）、轴承座（BH）和托盘（PLT）的装配与搬运任务。机器人首先从物料架或初始位置获取一个轴承和一个轴承座。随后，将这两个部件依次放置到右侧加工中心（RMC），推测在此处进行压装或组装操作。完成组装后，机器人从 RMC 取走已组装好的部件，并将其转移到左侧加工中心（LMC）进行暂存或后续处理。接着，机器人会去获取一个空托盘，并将此托盘放置到传送带（CNV）的指定工位。最后，机器人从 LMC 取回之前暂存的已组装部件，并将其精确地放置到传送带上的托盘中，完成整个循环作业。]

### 示例输出 (详细流程描述方案)

I. 主程序流程描述

    - 选择机器人型号 (例如 "dobot_mg400")。(块类型: `select_robot`)
    - 启动机器人电机。(块类型: `set_motor`)
    - 初始化必要的流程控制变量 (例如 `start_condition = 2`)。(块类型: `set_number`)
    - 机器人移动到**初始/安全点位 (例如 "P_Home")**。(块类型: `moveP`)
    - 主循环开始 (块类型: `loop`)
    - 检查条件: `start_condition = 2` (或无限循环以实现连续操作)。(块类型: `controls_if`)
    - **(可选/禁用逻辑)** 等待外部启动信号 (例如外部 IO 输入 `Start_Signal_IN`)。(块类型: `wait_external_io_input`)
    - 调用子程序 `BRG_Get_BRG` (获取轴承)。(块类型: `procedures_callnoreturn`)
    - 调用子程序 `Get_BH_InitialPos` (从初始位置获取轴承座)。(块类型: `procedures_callnoreturn`)
    - 机器人移动到**初始/安全点位 (例如 "P_Home")**。(块类型: `moveP`)
    - 等待加工中心 (RMC) 准备就绪的信号 (`RMC_Ready_IN`)。(块类型: `wait_external_io_input` 或 `wait_input`)
    - 调用子程序 `RMC_Put_BH&BRG` (将轴承座和轴承放置到 RMC)。(块类型: `procedures_callnoreturn`)
    - 等待 RMC 加工完成信号 (`RMC_Done_IN`)。(块类型: `wait_external_io_input` 或 `wait_input`)
    - 发出信号通知 RMC 部件已取走或准备取走 (`RMC_PartTaken_OUT`)。(块类型: `set_external_io_output_upon` 或 `set_output`)
    - 等待 RMC 确认信号 (`RMC_Confirm_IN`)。(块类型: `wait_external_io_input` 或 `wait_input`)
    - 调用子程序 `RMC_Get_BH_Assembled` (从 RMC 获取已组装部件)。(块类型: `procedures_callnoreturn`)
    - 机器人移动到**初始/安全点位 (例如 "P_Home")**。(块类型: `moveP`)
    - 调用子程序 `LMC_Put_BH_Temp` (将部件放置到 LMC 进行暂存)。(块类型: `procedures_callnoreturn`)
    - 机器人移动到**初始/安全点位 (例如 "P_Home")**。(块类型: `moveP`)
    - 调用子程序 `CNV_Get_PLT` (从传送带获取托盘)。(块类型: `procedures_callnoreturn`)
    - 调用子程序 `CNV_Put_PLT` (将托盘放置到传送带)。(块类型: `procedures_callnoreturn`)
    - 机器人移动到**初始/安全点位 (例如 "P_Home")**。(块类型: `moveP`)
    - 调用子程序 `LMC_Get_BH_Stored` (从 LMC 获取暂存部件)。(块类型: `procedures_callnoreturn`)
    - 机器人移动到**初始/安全点位 (例如 "P_Home")**。(块类型: `moveP`)
    - 调用子程序 `CNV_Put_BH_On_PLT` (将部件放置到传送带的托盘上)。(块类型: `procedures_callnoreturn`)
    - **(可选/禁用逻辑)** 发送任务完成信号给外部系统 (`Task_Complete_OUT`)。(块类型: `set_external_io_output_upon` 或 `set_output`)
    - 返回循环开始 (块类型: `return`)

II. 子程序及其功能描述

1.  **`BRG_Get_BRG` (获取轴承)**:

    - 功能：机器人从指定初始位置（例如物料架）获取一个轴承。
    - 涉及夹具：`BRG&PLT_Clamp` (操作轴承和托盘的夹具)。
    - 核心逻辑：
      - 移动到轴承拾取预备点 (例如 "P21")。(块类型: `moveP`)
      - 移动到轴承拾取上方 (例如 "P22")。(块类型: `moveP`)
      - 调用子程序 Open_BRG&PLT_Clamp。(块类型: `procedures_callnoreturn`)
      - 下降到轴承精确抓取点 (例如 "P23")。(块类型: `moveP`)
      - 调用子程序 Close_BRG&PLT_Clamp。(块类型: `procedures_callnoreturn`)
      - 带轴承上升 (例如 "P25")。(块类型: `moveP`)
      - 移动到轴承拾取离开点 (例如 "P26")。(块类型: `moveP`)
      - 返回轴承拾取预备点 (例如 "P21")。(块类型: `moveP`)

2.  **`Get_BH_InitialPos` (从初始位置获取轴承座)**: (对应 flow.xml 中的 `CNV_Get_BH`)

    - 功能：机器人从指定初始位置获取一个轴承座。
    - 涉及夹具：`BH_Clamp` (操作轴承座的夹具)。
    - 核心逻辑：
      - 移动到轴承座拾取预备点 (例如 "P31")。(块类型: `moveP`)
      - 移动到轴承座拾取上方 (例如 "P32")。(块类型: `moveP`)
      - 调用子程序 Open_BH_Clamp。(块类型: `procedures_callnoreturn`)
      - 下降到轴承座精确抓取点 (例如 "P33")。(块类型: `moveP`)
      - 调用子程序 Close_BH_Clamp。(块类型: `procedures_callnoreturn`)
      - 带轴承座上升 (例如 "P32")。(块类型: `moveP`)
      - 返回轴承座拾取预备点 (例如 "P31")。(块类型: `moveP`)

3.  **`RMC_Put_BH&BRG` (将轴承座和轴承放置到右侧加工中心)**:

    - 功能：机器人将先前获取的轴承座和轴承依次放置到右侧加工中心（RMC）的指定工位。
    - 涉及夹具：`BH_Clamp`, `BRG&PLT_Clamp`。
    - 核心逻辑：
      - RMC 过渡/移动点 (例如 "P20")。(块类型: `moveP`)
      - 移动到 RMC 轴承座放置预备点 (例如 "P11")。(块类型: `moveP`)
      - RMC 中间/传送点 (例如 "P12")。(块类型: `moveP`)
      - RMC 轴承座交互/接近点 (例如 "P14")。(块类型: `moveP`)
      - RMC 轴承座抓取/释放点 (例如 "P15")。(块类型: `moveP`)
      - 调用子程序 Open_BH_Clamp。(块类型: `procedures_callnoreturn`)
      - 设置速度为 10。(块类型: `set_speed`)
      - RMC 轴承座交互/接近点 (例如 "P14")。(块类型: `moveP`)
      - 设置速度为 100。(块类型: `set_speed`)
      - 移动到 RMC 轴承放置预备点 (例如 "P13")。(块类型: `moveP`)
      - RMC 轴承悬停/接近点 (例如 "P16")。(块类型: `moveP`)
      - 移动到 RMC 轴承精确放置点 (例如 "P17")。(块类型: `moveP`)
      - 调用子程序 Open_BRG&PLT_Clamp。(块类型: `procedures_callnoreturn`)
      - 设置速度为 10。(块类型: `set_speed`)
      - RMC 轴承悬停/接近点 (例如 "P16")。(块类型: `moveP`)
      - 设置速度为 100。(块类型: `set_speed`)
      - RMC 中间/传送点 (例如 "P12")。(块类型: `moveP`)
      - 移动到 RMC 离开/预备点 (例如 "P11")。(块类型: `moveP`)

4.  **`RMC_Get_BH_Assembled` (从右侧加工中心获取已组装部件)**: (对应 flow.xml 中的 `RMC_Get_BH`)

    - 功能：机器人从右侧加工中心（RMC）获取已组装（或处理完毕）的轴承座。
    - 涉及夹具：`BH_Clamp`。
    - 核心逻辑：
      - 移动到 RMC 已组装部件拾取预备点 (例如 "P11")。(块类型: `moveP`)
      - RMC 中间/传送点 (例如 "P12")。(块类型: `moveP`)
      - RMC 轴承座交互/接近点 (例如 "P14")。(块类型: `moveP`)
      - RMC 轴承座抓取/释放点 (例如 "P15")。(块类型: `moveP`)
      - 调用子程序 Close_BH_Clamp。(块类型: `procedures_callnoreturn`)
      - RMC 轴承座交互/接近点 (例如 "P14")。(块类型: `moveP`)
      - RMC 中间/传送点 (例如 "P12")。(块类型: `moveP`)
      - 带部件移动到 RMC 离开点 (例如 "P11")。(块类型: `moveP`)
      - RMC 过渡/移动点 (例如 "P20")。(块类型: `moveP`)

5.  **`LMC_Put_BH_Temp` (将部件放置到左侧加工中心进行暂存)**: (对应 flow.xml 中的 `LMC_Put_BH`)

    - 功能：机器人将从 RMC 取回的部件放置到左侧加工中心（LMC）进行暂存或后续处理。
    - 涉及夹具：`BH_Clamp`。
    - 核心逻辑：
      - LMC 传送/预备点 (例如 "P41")。(块类型: `moveP`)
      - LMC 悬停/接近点 (例如 "P42")。(块类型: `moveP`)
      - LMC 抓取/释放点 (例如 "P43")。(块类型: `moveP`)
      - 调用子程序 Open_BH_Clamp。(块类型: `procedures_callnoreturn`)
      - LMC 悬停/接近点 (例如 "P42")。(块类型: `moveP`)
      - LMC 传送/预备点 (例如 "P41")。(块类型: `moveP`)
      - 返回主安全/初始点 (例如 "P1")。(块类型: `moveP`)

6.  **`CNV_Get_PLT` (从传送带获取托盘)**:

    - 功能：机器人从指定位置（可能是传送带的另一区域）获取一个空托盘。
    - 涉及夹具：`BRG&PLT_Clamp`。
    - 核心逻辑：
      - 托盘处理预备点 (例如 "P34")。(块类型: `moveP`)
      - 托盘拾取悬停/上升点 (例如 "P35")。(块类型: `moveP`)
      - 设置速度为 10。(块类型: `set_speed`)
      - 下降到托盘精确抓取点 (例如 "P36")。(块类型: `moveP`)
      - 调用子程序 Close_BRG&PLT_Clamp。(块类型: `procedures_callnoreturn`)
      - 托盘拾取悬停/上升点 (例如 "P35")。(块类型: `moveP`)
      - 设置速度为 100。(块类型: `set_speed`)
      - 托盘处理预备点 (例如 "P34")。(块类型: `moveP`)

7.  **`CNV_Put_PLT` (将托盘放置到传送带)**:

    - 功能：机器人将获取到的空托盘放置到传送带的指定工位。
    - 涉及夹具：`BRG&PLT_Clamp`。
    - 核心逻辑：
      - CNV 托盘放置悬停/上升点 (例如 "P37")。(块类型: `moveP`)
      - 移动到传送带上托盘精确放置点 (例如 "P38")。(块类型: `moveP`)
      - 调用子程序 Open_BRG&PLT_Clamp。(块类型: `procedures_callnoreturn`)
      - CNV 托盘放置悬停/上升点 (例如 "P37")。(块类型: `moveP`)
      - 托盘处理预备点 (例如 "P34")。(块类型: `moveP`)

8.  **`LMC_Get_BH_Stored` (从左侧加工中心获取暂存部件)**: (对应 flow.xml 中的 `LMC_Get_BH`)

    - 功能：机器人从左侧加工中心（LMC）取回之前暂存的部件。
    - 涉及夹具：`BH_Clamp`。
    - 核心逻辑：
      - LMC 传送/预备点 (例如 "P41")。(块类型: `moveP`)
      - LMC 悬停/接近点 (例如 "P42")。(块类型: `moveP`)
      - LMC 抓取/释放点 (例如 "P43")。(块类型: `moveP`)
      - 调用子程序 Close_BH_Clamp。(块类型: `procedures_callnoreturn`)
      - LMC 悬停/接近点 (例如 "P42")。(块类型: `moveP`)
      - LMC 传送/预备点 (例如 "P41")。(块类型: `moveP`)

9.  **`CNV_Put_BH_On_PLT` (将部件放置到传送带的托盘上)**: (对应 flow.xml 中的 `CNV_Put_BH`)

    - 功能：机器人将从 LMC 取回的部件精确放置到传送带上预先放置好的托盘中。
    - 涉及夹具：`BH_Clamp`。
    - 核心逻辑：
      - CNV 部件上托盘悬停/上升点 (例如 "P39")。(块类型: `moveP`)
      - 移动到托盘上部件精确放置点 (例如 "P40")。(块类型: `moveP`)
      - 调用子程序 Open_BH_Clamp。(块类型: `procedures_callnoreturn`)
      - CNV 部件上托盘悬停/上升点 (例如 "P39")。(块类型: `moveP`)
      - 返回主安全/初始点 (例如 "P1")。(块类型: `moveP`)
      - 从子程序返回。(块类型: `return`)

10. **`Open_BH_Clamp` (打开轴承座夹具)**:

    - 功能：控制机器人末端执行器打开用于夹持轴承座的夹具。
    - 核心逻辑：
      - 等待预定义的夹具操作延迟 (例如定时器 "N483")。(块类型: `wait_timer`)
      - 发送信号打开轴承座夹具 (例如设置输出引脚 1 为开)。(块类型: `set_output`)
      - 等待确认轴承座夹具已打开的反馈 (例如等待输入引脚 0 为开)。(块类型: `wait_input`)

11. **`Close_BH_Clamp` (关闭轴承座夹具)**:

    - 功能：控制机器人末端执行器关闭用于夹持轴承座的夹具。
    - 核心逻辑：
      - 等待预定义的夹具操作延迟 (例如定时器 "N482")。(块类型: `wait_timer`)
      - 发送信号关闭轴承座夹具 (例如设置输出引脚 1 为关)。(块类型: `set_output`)
      - 等待确认轴承座夹具已关闭的反馈 (例如等待输入引脚 1 为开)。(块类型: `wait_input`)

12. **`Open_BRG&PLT_Clamp` (打开轴承/托盘夹具)**:

    - 功能：控制机器人末端执行器打开用于夹持轴承或托盘的夹具。
    - 核心逻辑：
      - 等待预定义的夹具操作延迟 (例如定时器 "N482")。(块类型: `wait_timer`)
      - 发送信号打开轴承/托盘夹具 (例如设置输出引脚 2 为开)。(块类型: `set_output`)
      - 等待确认轴承/托盘夹具已打开的反馈 (例如等待输入引脚 2 为开)。(块类型: `wait_input`)

13. **`Close_BRG&PLT_Clamp` (关闭轴承/托盘夹具)**:
    - 功能：控制机器人末端执行器关闭用于夹持轴承或托盘的夹具。
    - 核心逻辑：
      - 等待预定义的夹具操作延迟 (例如定时器 "N482")。(块类型: `wait_timer`)
      - 发送信号关闭轴承/托盘夹具 (例如设置输出引脚 2 为关)。(块类型: `set_output`)
      - 等待确认轴承/托盘夹具已关闭的反馈 (例如等待输入引脚 3 为开)。(块类型: `wait_input`)

III. 模块化与复用说明

- **夹具操作**: `Open/Close_BH_Clamp` 和 `Open/Close_BRG&PLT_Clamp` 被设计为独立的、可复用的子程序。它们封装了每种夹具类型的特定控制逻辑，并由各种物料搬运子程序（`BRG_Get_BRG`、`Get_BH_InitialPos`、`RMC_Put_BH&BRG` 等）调用。这提高了代码一致性并简化了维护。
- **标准移动序列**: 大多数拾取和放置子程序（`BRG_Get_BRG`、`Get_BH_InitialPos`、`CNV_Get_PLT` 等）遵循通用的"接近目标 -> 精确定位 -> 执行动作（抓取/释放）-> 离开目标 -> 返回安全位置"的移动模式。这种逻辑可以被抽象和复用，可能通过针对不同目标位置的参数化函数来实现。
- **速度控制**: 对于需要高精度或精细操作的作业（例如 `RMC_Put_BH&BRG`、`CNV_Get_PLT`），核心逻辑明确提到了在关键阶段降低速度的必要性。这可以通过参数或专用的低速移动函数来实现。
- **外部交互与同步**: 主流程包含多个与外部设备（RMC、LMC、传送带）同步的点。这是通过等待特定的输入信号（`RMC_Ready_IN`、`RMC_Done_IN`）和发送输出信号（`RMC_PartTaken_OUT`、`Task_Complete_OUT`）来实现的。这种模块化的方法确保了与周围环境的稳健交互。
- **可选逻辑**: 像等待外部启动信号或发送任务完成信号这样的功能被标记为可选。这允许灵活部署，可以根据特定的系统集成需求启用或禁用这些功能，而无需更改核心流程。
