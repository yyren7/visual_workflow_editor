# XML 节点定义文件创建规则

本文档规定了为流程编辑器创建新的节点定义 XML 文件时必须遵循的规则和格式。这些 XML 文件旨在作为前端可直接解析的块定义模板。

## 1. 存放位置

新的节点定义 XML 文件应存放于 `/workspace/database/node_database/quick-fcpr-new/` 目录下。

## 2. 文件命名

文件名应直接对应块的 `type` 属性，并以 `.xml` 为后缀。例如，对于类型为 `moveL` 的块，其定义文件名应为 `moveL.xml`。

## 3. 主要参考文件

在创建新的节点定义时，主要参考以下文件获取节点（块）的详细信息：

1.  **`database/document_database/quickfcpr.md`**:

    - **主要信息来源**：此文件包含了各种块的详细日文描述、输入参数（入力変数）、参数的名称（変数名）、形式、有效范围（有効範囲）、初期値（初始值）和具体内容说明。
    - **提取内容**：块的日文描述、参数的日文名、参数的中文描述（根据日文理解翻译）、参数类型/形式、参数的有效值范围、参数的默认初始值。

2.  **`flow.xml` (及类似的实际流程文件)**:

    - **参考用途**：查看块在实际流程中的 XML 结构、字段名 (`<field name=...>`) 的实际使用、以及块之间的连接方式 (`<next>`, `<statement>`)。
    - **验证格式**：确保生成的模板与实际使用的 XML 结构兼容。

3.  **`database/document_database/block_rules.md`**:
    - **参考用途**: 此文件本身包含了已标准化的 XML 模板示例，可作为新模板创建的直接参考，特别是关于注释格式和 `<block>` 属性的约定。

## 4. XML 文件基本结构

每个节点定义 XML 文件都必须是一个结构完整、格式正确的 XML 文档。

```xml
<?xml version="1.0" encoding="UTF-8"?>
<xml xmlns="https://developers.google.com/blockly/xml">
  <!-- 此处为单个 <block> 定义 -->
</xml>
```

- 第一行为 XML 声明：`<?xml version="1.0" encoding="UTF-8"?>`。
- 根元素为 `<xml xmlns="https://developers.google.com/blockly/xml">`。
- 根元素内部**仅包含一个** `<block>` 元素，用于定义该节点。

## 5. `<block>` 元素定义

`<block>` 元素是节点定义的核心。

```xml
<block type="BLOCK_TYPE" id="GENERATED_ID" data-blockNo="1">
  <!-- 字段定义 <field> -->
  <!-- 语句定义 <statement> (如果适用) -->
  <!-- 下一连接提示 (如果适用) -->
</block>
```

- **`type` 属性**: (必需) 字符串，表示块的类型，必须与文件名（不含 `.xml` 后缀）和 `quickfcpr.md` 中定义的块类型一致。
- **`id` 属性**: (必需) 字符串，固定为 `"GENERATED_ID"`。这是一个占位符，表示在实际流程中会生成唯一的 ID。
- **`data-blockNo` 属性**: (必需) 字符串，固定为 `"1"`。这是一个占位符，表示这是该类型块的第一个（模板）定义。

## 6. `<field>` 元素定义 (参数)

块的每个参数都通过一个 `<field>` 元素定义。

```xml
<field name="parameter_name">
  <!-- 注释1: 参数的日文名和中文描述 -->
  <!-- 注释2: 参数的有效范围 -->
  <!-- 注释3: 参数的初期値 (如果适用) -->
  <!-- 注释4: 参数的一个示例值 -->
</field>
```

- **`name` 属性**: (必需) 字符串，表示参数的名称。此名称应与 `quickfcpr.md` 中对应参数的 "変数名"（或从 `flow.xml` 观察到的实际字段名）一致。
- **`<field>` 元素内容**: `<field>` 标签内部**不应包含任何实际值**，只应包含用于描述该参数的 XML 注释。XML 注释必须放在 `<field>` 标签的内部。

- **注释规范**:

  1.  **参数描述**: `<!-- parameter_name (日文名 from quickfcpr.md): 中文描述. -->`
      - 示例: `<!-- robotName (ロボット名): 指定操作的机器人名称。 -->`
  2.  **有效范围**: `<!-- 有效范围: [具体值1, 具体值2, ... / 或范围描述] -->`
      - 示例 (枚举): `<!-- 有效范围: on (电源启动), off (电源停止) -->`
      - 示例 (范围/类型): `<!-- 有效范围: 在示教表中设定的点位名称 (最多 100 点) -->`
      - 示例 (布尔型等效): `<!-- 有效范围: enable (有效), disable (无效) -->`
  3.  **初期値 (初始值/默认值)**: (如果 `quickfcpr.md` 中有提供) `<!-- 初期値: [初始值] -->`
      - 示例: `<!-- 初期値: ON -->`
  4.  **示例值**: `<!-- 示例: [一个典型的有效值] -->`
      - 示例: `<!-- 示例: fairino_FR -->`
      - 对于 `none` 值，如果它对应 `quickfcpr.md` 中的某个特定含义（如 "no pallet"），应加以说明。示例: `<!-- 示例: none (对应 no pallet) -->`

  所有注释都应清晰、准确，严格遵循上述格式。

## 7. `<statement>` 元素定义 (嵌套块)

如果一个块可以包含其他嵌套的块（例如 `loop` 块），则使用 `<statement>` 元素定义。

```xml
<statement name="STATEMENT_NAME">
  <!-- 注释：说明此处可以嵌套哪些类型的块，或提供一个简单的嵌套示例 -->
  <!-- 例如: -->
  <!-- <block type="some_inner_block" ...> ... </block> -->
</statement>
```

- **`name` 属性**: (必需) 字符串，表示语句的名称 (例如 `DO`, `IF0`, `ELSE`)。此名称应与 `flow.xml` 或 Blockly 规范中的定义一致。
- 注释内容应指导用户如何在此处嵌套块。

## 8. `<next>` 元素提示 (顺序连接)

如果一个块通常会连接到下一个块，可以在模板的末尾（但在结束的 `</block>` 标签之前）添加一个注释提示。

```xml
  <!-- <next> ... </next> -->
</block>
```

这仅作为提示，模板本身不定义实际的下一个块。

## 9. 无参数或无特定子元素的块

对于没有 `<field>` 参数的块（例如 `return` 块），其 `<block>` 元素内部可以直接是描述该块用途的注释。

```xml
<block type="return" id="GENERATED_ID" data-blockNo="1">
  <!-- 该块通常没有自己的 'field' 参数 -->
  <!-- 用于从 loop 块的 statement 中返回循环开始 -->
</block>
```

## 10. 严格性要求

- **格式一致性**: 所有 XML 文件必须严格遵循上述格式，以确保前端可以正确解析和使用。
- **信息准确性**: 从 `quickfcpr.md` 提取的信息（如日文名、有效范围、初期值）必须准确无误。
- **注释完整性**: 每个 `<field>` 都必须包含规定格式的注释。

遵循这些规则有助于确保所有节点定义的一致性和可用性。
