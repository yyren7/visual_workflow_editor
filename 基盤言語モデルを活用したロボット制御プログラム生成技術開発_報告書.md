
# 基盤言語モデルを活用したロボット制御プログラム生成技術開発 完成報告書

**任 奕宇 (生産技術研究所 RES2)**

---

### 概要
本報告書は、「基盤言語モデルを活用したロボット制御プログラム生成技術開発」プロジェクトの成果をまとめたものである。本開発では、ロボットプログラミングの専門知識を持たない非技術者でも、日常的な自然言語を用いてロボットを直感的に操作可能にすることを目的とした対話型システムを構築した。LangGraphフレームワークを中核に据え、LLM（大規模言語モデル）とテンプレート技術を融合させたハイブリッドアプローチ、そして対話型検証・修正サイクルを導入することで、従来手法が抱えていた「推論コスト」「正答率」「システムの信頼性」という三大課題の解決を図った。本報告では、その技術的アプローチと実証結果、そして今後の展望について詳述する。

---

### 1. 背景
近年、製造業における人手不足の深刻化と生産性向上の要求を背景に、ロボット活用の裾野は急速に拡大している。しかし、その活用は依然としてロボットプログラミングの専門知識を持つ一部の技術者に限定されており、現場の作業員などが日常的にロボットを操作することは困難であった。

本システムは、この障壁を取り除くため、ロボットプログラマーではない非技術者でも、**日常的な言葉でロボットを運用可能にすること**を究極の目的として開発された。その実現手段として、自然言語による指示を解釈し、ロボットが実行可能な制御プログラムを自動生成するための、専用対話型インターフェースを実装した。これにより、プログラミング言語の知識がなくとも、誰もがロボットの能力を引き出せる世界の実現を目指す。

[図表1: システム概念図]

### 2. 課題
開発初期において、自然言語からロボット制御プログラムを生成する上で、以下の主要な課題に直面した。

*   **XMLフォーマットのコード生成:**
    ロボット制御で用いられるQuickfcpは、厳格な構文を持つXMLベースのフォーマットである。曖昧さを含む自由形式の自然言語から、この厳格な構造を持つXML形式へ一貫性と正確性を持って変換することは、本質的に困難な課題であった。

*   **推論コストの高さ:**
    従来のAI手法では、ロボットの全APIドキュメントや操作マニュアルなど、大量のコンテキスト情報をLLMにプロンプトとして与える必要があった。これはAPI呼び出しごとに膨大なトークン量を消費し、推論コストの増大と応答遅延を招く大きな要因となっていた。

*   **システムの安定性と信頼性:**
    LLMによる生成は、その確率的な性質から本質的に「揺れ」を持つため、一度の生成で完璧なプログラムを得ることは極めて難しい。生成されたプログラムの動作が不安定であったり、意図しない挙動を示したりすることがあり、ユーザーが結果を信頼できないことが実運用の大きな障壁となっていた。

*   **結果の正答率:**
    上記の要因が複合的に絡み合うことで、最終的に生成されるコードの正答率が低迷した。結果として、専門家による大幅な手修正が不可欠となり、「非技術者の利用」という本来の目的を達成できない状況にあった。

[図表2: 開発初期の課題]

### 3. 解決手法
上記の課題群を解決するため、本開発では複数メーカーのロボットコマンドを統一的に扱うための標準フォーマットとして **Quickfcp** を採用した。その上で、**LangGraphフレームワーク**を中核に据え、状態管理と対話型修正サイクルを組み込んだ、以下の特徴を持つ**逐次実行型マルチエージェントシステム**を構築した。

[図表3: 解決アプローチの概要]

#### 3.1 段階的生成と対話型検証サイクルを持つAgentワークフロー
一度に完璧なプログラムを生成するのではなく、プロセスを複数のステップに分割。「目的のヒアリング」→「手順の生成・提案」→「コードへの変換」→「ユーザーによる確認・修正」という段階的なワークフローを構築した。各ステップで生成された中間結果（例：タスクの分解リスト）をユーザーに提示し、GUIを介してフィードバックを求める。この対話型検証サイクルにより、ユーザーはAIの思考プロセスを理解し、早い段階で軌道修正を行うことが可能となり、最終的な成果物の正答率を飛躍的に向上させた。

#### 3.2 LLMとテンプレートのハイブリッドなコード生成アーキテクチャ
LLMの役割を、創造性が求められる「自然言語の解釈・翻訳・要約」タスクに特化させた。一方、厳密な構文が要求されるQuickfcpのXMLコード生成は、構造化されたテンプレートエンジンが担う。LLMが自然言語から抽出したパラメータ（例：「アームを10cm上に動かす」→ 動作: `move`, 座標: `z+10`）をテンプレートに埋め込むことで、構文の正確性を100%保証しつつ、LLMの柔軟性を両立させるハイブリッドなアーキテクチャを実現した。

#### 3.3 堅牢な状態管理と永続化
LangGraphが提供する状態管理（State Management）機能を活用し、ユーザーとの対話セッション全体の状態（過去の指示、生成されたコード、ユーザーの修正履歴など）を永続化する仕組みを導入した。これにより、システムは文脈を維持した長期的な対話が可能となり、中断からの再開や過去の対話履歴を踏まえた、より高度なプログラム生成が実現された。

[図表4: ハイブリッド生成アーキテクチャ]

### 4. 考察及び将来像
本開発を通じて、以下の重要な知見を得た。

*   **LLMの役割分担の重要性:**
    LLMを創造的な「翻訳・要約」タスクに特化させ、厳密さが求められるコード生成をテンプレートベースで行うハイブリッドアプローチは、AIエージェント開発において**正答率とコスト効率を両立させるための極めて有効な設計パターン**である。全てのタスクを単一の巨大なLLMに委ねるのではなく、適材適所で技術を使い分けることの重要性が示された。

*   **「完璧な一発回答」から「対話による共創」へ:**
    AIによるプログラム生成の課題は、AIの性能向上だけで解決するものではない。むしろ、**ユーザーを修正プロセスに巻き込む対話型の設計**こそが、非専門家の運用性を保証する上で最も重要な要素であった。ユーザーの意図を段階的に分解し、GUIを介して対話的に確認・修正を促す仕組みは、AIと人間が協働で価値を創造する「共創」モデルの有効性を証明した。

#### 今後の課題
本システムのさらなる発展のため、以下の課題に取り組む必要がある。

*   **RAG（Retrieval-Augmented Generation）の拡張:**
    より多様な工程パターンや複雑なロボットタスクに対応するため、RAGで利用するベクトルデータベースの継続的な拡張と、そこから最適な情報を引き出す検索精度の向上が求められる。

*   **自己改善ループの組み込み:**
    ユーザーからの修正フィードバックを収集・分析し、それを基にLLMやテンプレートが自己改善する学習ループを組み込むことで、システムは使うほどに賢くなる。

*   **ティーチングロジックの高度化:**
    現在は手動での調整が必要な座標ティーチングに関し、カメラなどのセンサー情報やシミュレーション結果を基に、生成されたXMLのパラメータ（座標値など）を自動で最適化するロジックをさらに高度化していく。

[図表5: 将来のシステム構成イメージ]

### 5. まとめ
本研究開発では、非技術者でも自然言語でロボットを操作可能なQuickfcpプログラム生成システムを構築した。「推論コスト」「正答率」「安定性」という従来の中心的な課題に対し、**LangGraphによる状態機械の導入**、**LLMとテンプレートのハイブリッド生成**、そして**対話型検証サイクル**という複合的な技術アプローチを組み合わせることで、解決への明確な道筋を示した。

結果として、開発初期に設定したKPI（Key Performance Indicator）を達成し、ロボットプログラミングの民主化と、それに伴う生産現場の省人化・効率化に大きく貢献できるシステムの実現に、確かな見通しを立てることができた。

### 6. 参考文献
[1] (参考文献をここに追加) 