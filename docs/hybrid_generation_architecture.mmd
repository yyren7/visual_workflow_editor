%%{init: {
  'theme': 'base',
  'themeVariables': {
    'primaryColor': '#E3F2FD',
    'primaryTextColor': '#1565C0',
    'primaryBorderColor': '#1976D2',
    'lineColor': '#1976D2',
    'secondaryColor': '#F3E5F5',
    'tertiaryColor': '#E8F5E8',
    'background': '#FFFFFF',
    'mainBkg': '#E3F2FD',
    'secondBkg': '#F3E5F5',
    'tertiaryBkg': '#E8F5E8',
    'node0Fill': '#FFEBEE',
    'node1Fill': '#E1F5FE',
    'node2Fill': '#F1F8E9'
  }
}}%%

flowchart TD
    %% ===== æ··åˆç”Ÿæˆæ¶æ„å±‚æ¬¡å›¾ =====
    
    %% ç”¨æˆ·è¾“å…¥å±‚
    A["`**[å…¥åŠ›] ãƒ¦ãƒ¼ã‚¶ãƒ¼è‡ªç„¶è¨€èªå…¥åŠ›**
    ğŸ“ è‡ªç„¶è¨€èªã«ã‚ˆã‚‹è¦æ±‚è¨˜è¿°`"]
    
    %% LLMå¤„ç†å±‚ - åˆ›é€ æ€§ä»»åŠ¡
    subgraph LLM_ZONE ["`ğŸ§  **LLMè²¬ä»»ã‚¾ãƒ¼ãƒ³** - å‰µé€ æ€§ãƒ»è§£é‡ˆã‚¿ã‚¹ã‚¯`"]
        B1["`**[è§£æ] æ„å›³ç†è§£ãƒ»æŠ½å‡º**
        ğŸ” è‡ªç„¶è¨€èªâ†’æ§‹é€ åŒ–ãƒ‡ãƒ¼ã‚¿
        âš¡ ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆ: æœ€å¤§10å±¥æ­´ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸`"]
        
        B2["`**[åˆ†è§£] ã‚¿ã‚¹ã‚¯æ§‹é€ åŒ–**
        ğŸ“‹ é«˜ãƒ¬ãƒ™ãƒ«ã‚¿ã‚¹ã‚¯ãƒªã‚¹ãƒˆç”Ÿæˆ
        âš¡ ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆ: ã‚¿ã‚¹ã‚¯å®šç¾©ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆ`"]
        
        B3["`**[è©³ç´°åŒ–] ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã‚¹ãƒ†ãƒƒãƒ—ç”Ÿæˆ**
        ğŸ”§ ä¸¦åˆ—å‡¦ç†ã§å®Ÿè¡Œå¯èƒ½ã‚¹ãƒ†ãƒƒãƒ—åŒ–
        âš¡ åˆ¶ç´„: åˆ©ç”¨å¯èƒ½ãƒ–ãƒ­ãƒƒã‚¯çŸ¥è­˜ãƒ™ãƒ¼ã‚¹`"]
    end
    
    %% ç”¨æˆ·å®¡æ ¸å±‚
    subgraph REVIEW_ZONE ["`ğŸ‘¤ **ãƒ¦ãƒ¼ã‚¶ãƒ¼å¯©æŸ»ã‚¾ãƒ¼ãƒ³** - å“è³ªç®¡ç†`"]
        C1["`**[ç¢ºèª] ã‚¿ã‚¹ã‚¯ãƒªã‚¹ãƒˆå¯©æŸ»**
        âœ… æ‰¿èª / ğŸ“ ä¿®æ­£è¦æ±‚`"]
        
        C2["`**[ç¢ºèª] ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«è©³ç´°å¯©æŸ»**
        âœ… æ‰¿èª / ğŸ“ ä¿®æ­£è¦æ±‚`"]
    end
    
    %% æ¨¡æ¿å¼•æ“å±‚ - ç²¾ç¡®ä»£ç ç”Ÿæˆ
    subgraph TEMPLATE_ZONE ["`âš™ï¸ **ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã‚¨ãƒ³ã‚¸ãƒ³è²¬ä»»ã‚¾ãƒ¼ãƒ³** - ç²¾å¯†ã‚³ãƒ¼ãƒ‰ç”Ÿæˆ`"]
        D1["`**[ç”Ÿæˆ] å€‹åˆ¥XMLç”Ÿæˆ**
        ğŸ“„ ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆãƒ™ãƒ¼ã‚¹å¤‰æ›
        âš¡ æ§‹æ–‡ç²¾åº¦: 100%ä¿è¨¼`"]
        
        D2["`**[ãƒãƒƒãƒ”ãƒ³ã‚°] ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿é–¢é€£ä»˜ã‘**
        ğŸ”— è«–ç†ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿â†’ç‰©ç†ã‚¹ãƒ­ãƒƒãƒˆ
        âš¡ ãƒ‡ãƒ¼ã‚¿æ•´åˆæ€§ãƒã‚§ãƒƒã‚¯`"]
        
        D3["`**[çµ±åˆ] XMLçµåˆå‡¦ç†**
        ğŸ”„ å€‹åˆ¥XMLâ†’çµ±åˆãƒ•ãƒ­ãƒ¼
        âš¡ æ§‹é€ æ•´åˆæ€§ä¿æŒ`"]
        
        D4["`**[å®Œæˆ] æœ€çµ‚XMLé€£çµ**
        âœ¨ å®Ÿè¡Œå¯èƒ½ãƒ—ãƒ­ã‚°ãƒ©ãƒ å‡ºåŠ›
        âš¡ å®Œå…¨è‡ªå‹•åŒ–å‡¦ç†`"]
    end
    
    %% è¾“å‡ºå±‚
    E["`**[å‡ºåŠ›] å®Ÿè¡Œå¯èƒ½XMLãƒ—ãƒ­ã‚°ãƒ©ãƒ **
    ğŸ¯ ãƒ­ãƒœãƒƒãƒˆåˆ¶å¾¡ã‚³ãƒ¼ãƒ‰å®Œæˆ`"]

    %% ==== ãƒ¡ã‚¤ãƒ³ãƒ•ãƒ­ãƒ¼ï¼ˆå¤ªç·šï¼‰ ====
    A ==>|"è‡ªç„¶è¨€èªå…¥åŠ›"| B1
    B1 ==> B2
    B2 ==>|"æ§‹é€ åŒ–ã‚¿ã‚¹ã‚¯ãƒ‡ãƒ¼ã‚¿"| C1
    C1 ==>|"æ‰¿èªæ¸ˆã¿"| B3
    B3 ==>|"è©³ç´°ã‚¹ãƒ†ãƒƒãƒ—ãƒ‡ãƒ¼ã‚¿"| C2
    C2 ==>|"ç”Ÿæˆé–‹å§‹"| D1
    D1 ==> D2
    D2 ==> D3
    D3 ==> D4
    D4 ==>|"å®Œæˆãƒ—ãƒ­ã‚°ãƒ©ãƒ "| E

    %% ==== ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯ãƒ«ãƒ¼ãƒ—ï¼ˆç‚¹ç·šï¼‰ ====
    C1 -.->|"ä¿®æ­£è¦æ±‚"| B2
    C2 -.->|"ä¿®æ­£è¦æ±‚"| B3

    %% ==== ä¸Šä¸‹æ–‡æœ€é©åŒ–æƒ…å ±ï¼ˆæ³¨é‡ˆï¼‰ ====
    
    subgraph CONTEXT_OPT ["`ğŸ’¡ **ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆæœ€é©åŒ–æˆ¦ç•¥**`"]
        direction TB
        O1["`**Tokenå‰Šæ¸›æŠ€è¡“**
        â€¢ å±¥æ­´åˆ¶é™: æœ€å¤§10ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸
        â€¢ æ®µéšçš„å‡¦ç†: å¿…è¦æƒ…å ±ã®ã¿ä¼æ’­
        â€¢ æ§‹é€ åŒ–çŠ¶æ…‹: Pydanticãƒ¢ãƒ‡ãƒ«æ´»ç”¨`"]
        
        O2["`**LLMåŠ¹ç‡åŒ–**
        â€¢ ä¸¦åˆ—ã‚¿ã‚¹ã‚¯å‡¦ç†
        â€¢ ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆåŒ–ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆ
        â€¢ ã‚¹ãƒˆãƒªãƒ¼ãƒŸãƒ³ã‚°å‡ºåŠ›`"]
        
        O3["`**ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆç²¾åº¦**
        â€¢ XMLã‚¹ã‚­ãƒ¼ãƒå³å¯†æº–æ‹   
        â€¢ ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿æ¤œè¨¼
        â€¢ è‡ªå‹•æ§‹æ–‡ãƒã‚§ãƒƒã‚¯`"]
    end

    %% ==== ãƒã‚¤ãƒ–ãƒªãƒƒãƒ‰åˆ†é›¢ç‚¹ã®å¼·èª¿ ====
    subgraph SEPARATION ["`âš¡ **ãƒã‚¤ãƒ–ãƒªãƒƒãƒ‰åˆ†é›¢ç‚¹**`"]
        SEP1["`**å‰µé€ æ€§ â†” ç²¾å¯†æ€§**
        LLM: è§£é‡ˆãƒ»æ¨è«–ãƒ»å‰µé€ 
        TemplateEngine: æ§‹æ–‡ãƒ»ç²¾åº¦ãƒ»å®Ÿè¡Œ`"]
    end

    %% ==== ã‚¹ã‚¿ã‚¤ãƒªãƒ³ã‚° ====
    classDef llmNode fill:#E1F5FE,stroke:#0277BD,stroke-width:3px,color:#01579B,font-weight:bold
    classDef reviewNode fill:#F3E5F5,stroke:#7B1FA2,stroke-width:3px,color:#4A148C,font-weight:bold  
    classDef templateNode fill:#E8F5E8,stroke:#388E3C,stroke-width:3px,color:#1B5E20,font-weight:bold
    classDef inputOutputNode fill:#FFEBEE,stroke:#D32F2F,stroke-width:4px,color:#B71C1C,font-weight:bold
    classDef optimizationNode fill:#FFF3E0,stroke:#F57C00,stroke-width:2px,color:#E65100
    classDef separationNode fill:#FCE4EC,stroke:#C2185B,stroke-width:3px,color:#880E4F,font-weight:bold

    %% ãƒãƒ¼ãƒ‰ã‚¯ãƒ©ã‚¹é©ç”¨
    class B1,B2,B3 llmNode
    class C1,C2 reviewNode
    class D1,D2,D3,D4 templateNode
    class A,E inputOutputNode
    class O1,O2,O3 optimizationNode
    class SEP1 separationNode

    %% ã‚µãƒ–ã‚°ãƒ©ãƒ•ã‚¹ã‚¿ã‚¤ãƒªãƒ³ã‚°
    LLM_ZONE ~~~ REVIEW_ZONE
    REVIEW_ZONE ~~~ TEMPLATE_ZONE
    TEMPLATE_ZONE ~~~ CONTEXT_OPT
    CONTEXT_OPT ~~~ SEPARATION 