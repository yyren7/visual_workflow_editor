# 可视化工作流编辑器产品需求文档

## 语言

zh_cn

## 编程语言

Python/JavaScript

## 原始需求

创建一个基于 React 前端和 FastAPI 后端的网站，核心功能是提供一个以 n8n 为灵感、基于 Reactflow 的可视化流程图交互界面。并且提供利用 LLM API 结合 LangChain 进行节点的生成/修改功能。

## 项目名称

visual_workflow_editor

## 产品目标

1. 构建直观易用的可视化流程图编辑平台，支持多用户和多项目管理
2. 提供强大的 AI 辅助功能，实现基于自然语言的节点生成与修改能力
3. 实现灵活的变量管理系统，支持全局和局部作用域
4. 创建完整的版本控制和历史记录功能，确保工作安全性
5. 支持多语言界面并优化用户协作体验

## 用户故事

1. 作为项目管理者，我希望能够创建多个独立项目来组织不同类型的工作流，并分享给团队成员进行协作
2. 作为工作流设计师，我希望能够通过拖拽节点的方式快速创建和编辑流程图，并使用直观的连接方式定义节点间的数据流
3. 作为技术人员，我希望能够通过自然语言描述自动生成复杂节点，避免手动配置复杂参数
4. 作为流程维护者，我希望系统能够记录流程图的版本历史，并允许我随时回滚到之前的版本
5. 作为团队成员，我希望能够与其他人实时协作编辑同一个流程图，并清晰地看到各自所做的修改
6. 作为管理员，我希望能够定义和管理节点模板库，扩展系统的功能范围
7. 作为开发者，我希望能够导出流程图为标准格式，以便集成到其他系统中
8. 作为非技术用户，我希望有详细的使用文档和上下文帮助信息，降低学习曲线

## 需求分析

本项目旨在构建一个新一代的可视化工作流编辑平台，重点是结合现代化 UI 设计与 AI 辅助能力，为用户提供直观、高效的流程设计体验。核心技术架构基于 React 前端和 FastAPI 后端，利用 Reactflow 提供流程图可视化和交互能力，并通过 LangChain 集成 LLM API 实现智能化节点生成与修改功能。

### 主要功能需求

1. **多层级组织结构**

   - 支持用户、项目、流程图的三级组织结构
   - 实现细粒度的权限控制和资源共享机制

2. **流程图编辑功能**

   - 基于 Reactflow 实现拖拽式流程图编辑
   - 支持节点搜索、分组、复制粘贴等高级编辑功能
   - 提供撤销/重做、缩放、对齐等编辑工具

3. **节点模板系统**

   - 预置常用节点类型（如条件判断、循环、API 请求等）
   - 支持自定义节点模板的创建和管理
   - 提供节点分类和搜索功能

4. **AI 辅助节点生成**

   - 通过自然语言描述自动生成节点
   - 支持基于上下文的节点配置优化
   - 提供代码生成和验证功能

5. **变量管理系统**

   - 支持流程图级全局变量
   - 支持节点级局部变量
   - 实现变量类型、作用域和访问控制

6. **版本控制与历史记录**

   - 自动保存编辑历史
   - 支持创建命名版本
   - 提供版本比较和回滚功能

7. **多语言支持**

   - 支持中文、英文、日文界面切换
   - 所有系统消息和文档支持多语言

8. **导入导出功能**

   - 支持标准 JSON 格式的流程图导入导出
   - 提供与其他系统的兼容性选项

9. **协作功能**
   - 支持多用户同时编辑同一流程图
   - 实时更新和冲突解决机制
   - 变更历史和操作审计

## 需求优先级

| 优先级 | 需求描述                                                            |
| ------ | ------------------------------------------------------------------- |
| P0     | 实现基于 Reactflow 的可视化流程图编辑界面，支持多项目和多流程图管理 |
| P0     | 集成 LLM API，支持通过自然语言生成和修改节点                        |
| P0     | 实现节点模板系统，支持预置和自定义节点类型                          |
| P1     | 实现全局和局部变量管理系统，支持 JSON 格式的外部文件导入导出        |
| P1     | 实现版本控制和历史记录功能，包括自动保存和版本回滚                  |
| P1     | 实现多语言支持（中、英、日）                                        |
| P2     | 实现多用户协作功能，支持实时编辑和冲突解决                          |
| P2     | 实现高级节点功能，包括条件分支、循环、并行执行等                    |
| P3     | 实现流程图执行引擎，支持调试和监控                                  |

## UI 设计概要

系统采用现代化的三栏式布局设计，提供清晰的视觉层次和直观的操作体验：

### 主界面布局

1. **左侧边栏**

   - LLM 对话接口，用于通过自然语言生成和修改节点
   - 项目和流程图列表，支持搜索和导航
   - 节点模板库，提供分类浏览和搜索

2. **中央主区域**

   - Reactflow 流程图编辑画布
   - 缩放、对齐、撤销/重做等编辑工具栏
   - 迷你地图和导航辅助工具

3. **右侧边栏**

   - 节点属性编辑面板
   - 全局变量管理面板
   - 版本历史记录面板
   - 注释和文档面板

4. **顶部导航栏**
   - 用户信息和设置
   - 保存/加载/导出选项
   - 视图模式切换
   - 语言选择

### 交互设计原则

- 采用直接操作原则，最小化模态对话框使用
- 提供即时反馈和视觉提示
- 实现上下文相关的帮助和提示
- 支持键盘快捷键和高级用户操作模式
- 适配不同屏幕尺寸，支持响应式设计

### 视觉风格

- 简洁现代的设计语言
- 用户可选的亮/暗色主题
- 高对比度界面元素，确保可访问性
- 一致的图标和视觉元素系统

## 技术要求

### 前端技术栈

- React 18+ 和 TypeScript
- Reactflow 作为流程图引擎
- Zustand (或 Redux Toolkit) 进行状态管理
- Material-UI (或 Ant Design) 作为 UI 组件库
- i18next 处理国际化
- Axios 处理 API 请求
- React Testing Library 和 Jest (或 Vitest) 进行测试

### 后端技术栈

- FastAPI 作为 Web 框架
- SQLAlchemy 作为 ORM
- PostgreSQL (或其他兼容数据库) 作为主数据库
- Redis (可选) 用于缓存和实时功能
- LangChain 用于集成 LLM 功能
- 支持 OpenAI/Azure OpenAI (或其他兼容 API) 作为 LLM 提供者
- Celery (可选) 用于异步任务处理
- JWT 处理认证
- Pydantic 进行数据验证
- pytest 进行测试

### 部署要求

- Docker 容器化
- CI/CD 流水线支持
- 可选的 Kubernetes 部署配置
- 性能监控和日志收集
- 备份和恢复策略

## 集成需求

### 外部系统集成

1. **LLM API 集成**

   - 支持 OpenAI、Azure OpenAI 或其他兼容接口
   - 实现可配置的模型选择和参数控制
   - 提供 API 密钥管理和请求限制

2. **机器人 API 集成**

   - 支持 DobotApiDashboard, DobotApi, DobotApiMove 等接口
   - 提供通用的机器人控制节点模板
   - 实现代码生成和验证功能

3. **其他潜在集成点**
   - 支持常见数据源连接（数据库、API、文件系统等）
   - 提供通用的 Webhook 支持
   - 实现邮件和消息通知集成

## 安全要求

1. 实现健壮的用户认证和授权系统
2. 确保所有 API 端点的安全访问控制
3. 防止常见的 Web 安全威胁（XSS, CSRF, SQL 注入等）
4. 敏感配置信息（如 API 密钥）的安全存储
5. 实现审计日志系统，记录关键操作

## 性能要求

1. 页面加载时间小于 2 秒
2. 支持至少 100 个节点的复杂流程图流畅编辑
3. AI 辅助功能的响应时间控制在 5 秒以内
4. 支持至少 50 名并发用户
5. 自动保存功能对用户编辑的影响最小化

## 待明确事项

1. **LLM API 细节**

   - 确定将使用哪个特定的 LLM 提供商和接口版本
   - 确认所需的模型参数和限制
   - 定义系统提示（System Prompt）和格式规范

2. **机器人操作代码细节**

   - 获取 DobotApiDashboard, DobotApi, DobotApiMove 的完整 API 文档
   - 明确各类型机器人的操作参数和限制条件
   - 定义代码生成的模板和验证规则

3. **数据存储策略**

   - 确定流程图版本存储的具体实现方式
   - 明确大型流程图的性能优化策略
   - 确定数据备份和迁移计划

4. **部署和扩展计划**
   - 确定具体的部署环境和资源需求
   - 明确后续功能扩展的路线图
   - 规划性能监控和优化策略
